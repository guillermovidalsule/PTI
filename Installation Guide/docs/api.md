# API
An API, or Application Programming Interface, is a set of rules and protocols that allows different software applications to communicate with each other. It defines the methods and data structures that developers can use to interact with the software component.

## Introduction
The REST API we have developed is a set of endpoints that allow different components of the system to communicate with each other such as our web/app with our database. These endpoints are used to retrieve and update data in the system. The API is designed to be flexible and can be extended to support new features and functionalities in the future. We have also implemented authentication and authorization mechanisms to ensure that only authorized users can access certain endpoints. We mainly can differentiate between robots and users endpoints. We have used the the programming language Golang and we have connected the API to a MongoDB database. If you want to know more details about how the code's API and the structure is, please refer to the our [github repository](https://github.com/guillermovidalsule/PTI/tree/main/restful-api).

## User Model
The user model is a collection of fields that represent the user's information. These fields include the user's username, email, password, and ID that is unique to each user. The user model also includes a field for the time it was created and the time it was last updated. The user model also contains a field for a token that is used to authenticate the user. The token is generated when the user is registered and is valid for a certain period of time. The token is updated every time the user logs in.

## User Endpoints
The following endpoints are used to manage users, allowing them to register, login, and consult their information. The endpoints are divided into two categories: public and private. The public ones are accesible to anyone and the private one is only accesible trhough a token.

- `/users/signup`: This endpoint is used to register a new user and is a POST request where you have to provide the user's information such as username, email, and password in a JSON format. The endpoint returns a JSON response with the user's token if the registration is successful. The user is created and their information is stored in the database and can be logged in. The endpoint uses an internal function called SignUp to handle the registration process and inside the function, it checks if the username and email already exist in the database. If they do, it returns an error message. The function also hashes the password with another internal function called HashPassword and stores it in the database. This endpoint is public because you do not need to proivide a token in the header of the request.

- `/users/login`: This endpoint is used to log in as a user and is a POST request where you have to provide the user's username and password in a JSON format. The endpoint returns a JSON response with all user's information if the login is successful. The endpoint uses an internal function called Login to handle the login process and inside the function, it checks if the username and password match the ones stored in the database through an internal function called VerifyPassword. If they do, it returns the user's information. If the login fails, it returns an error message.This endpoint is public because you do not need to proivide a token in the header of the request.

- `/users/consulta`: This endpoint is used to obtain user information and is a GET request. You need to provide the user's token in the header of the request to authenticate the user. The endpoint uses an internal function called Consult to obtain the user's information from the database based on the token provided. The function returns a JSON response with the user's information. This endpoint is private because you need to provide a token in the header of the request to access it.

## Robot Model
The robot model is a collection of fields that represent the robot's information. These fields include the robot's name, id, idle, state and the id of the user owning the robot. The robot model also includes a field for the time it was created and the time it was last updated. The robot model contains a struct called Macros that contains the information of some aspects of the robot such as the frequency of the cpu, the temperature and the velocity of the robot. Finally this model conatains the route that the robot is following and that route is represented by an array of points which point is composed by two values latitude and longitude.

## Robot Endpoints
The following endpoints are used to manage robots, allowing the user to create and delete robots among other functions. All the endpoints are private and the system needs to provide the specific token of their owner in the header of the request to access them.

- `/robot/alta`: This endpoint is used to create a robot and is a POST request where you have to provide the robot's name in a JSON format. The endpoint returns a JSON response with a message indicating if the creation was successful or not. The endpoint uses an internal function called CreateRobotForUser to handle the creation process and inside the function, it checks if the robotname already exists in the full set of robots of the user in the database. All the fields of the robot are filled with default values.

- `/robot/baja/:robotname`: This endpoint is used to delete a robot and is a POST request where you have to specify the name of the robot in the URL. We match the robot with the owner thanks to the token provided in the header of the request. The endpoint returns a JSON response with a message indicating if the deletion was successful or not. The endpoint uses an internal function called DeleteRobotForUser to handle the deletion process and inside the function, it checks if the robotname exists in the full set of robots of the user in the database.

- `/robot/listar`: This endpoint is used to obtain the information of all the robots of the user and is a GET request. The endpoint returns a JSON response with an array of robots with their information. The endpoint uses an internal function called ListUserRobots to handle the listing process and inside the function, it checks if the user has any robots in the database. In the case of not having any robots, the endpoint returns an empty array.

- `/robot/consulta/:robotname`: This endpoint works as the /robot/listar endpoint but instead of returning the information of all the robots of the user, it returns the information of an specific robot that matches the name provided in the URL. The endpoint uses an internal function called ConsultUserRobot to handle the obtaining process and inside the function, it checks if the robotname exists in the full set of robots of the user in the database. If the robotname does not exist, the endpoint returns an error message.

- `/robot/refresh_macros/:robotname`: This endpoint is used to update the macros of a robot and is a POST request where you have to provide the robot's name in the URL and the new macros in a JSON format. The endpoint returns a JSON response with all the information of the robot and the new macros updated. The endpoint uses an internal function called RefreshMacrosRobot to handle the updating process and inside the function, it checks if the robotname exists in the full set of robots of the user in the database.

- `robot/desactivar/:robotname`: This endpoint is used to desactivate a robot and is a POST request where you have to provide the robot's name in the URL. The endpoint returns a JSON response with a message indicating if the desactivation was successful or not. The endpoint uses an internal function called DesactivateRobot to handle the desactivation process and inside the function, it checks if the robotname exists in the full set of robots of the user in the database.
- `robot/refresh_route/:robotname`: This endpoint is used to update the route of a robot and is a POST request where you have to provide the robot's name in the URL and the new route in a JSON format. The endpoint returns a JSON response with a message indicating if the updating was successful or not. The endpoint uses an internal function called RefreshRoute to handle the updating process and inside the function, it checks if the robotname exists in the full set of robots of the user in the database.


## Authentication and Authorization
The system uses a token-based authentication and authorization mechanism. We use a JWT (JSON Web Token) to generate and verify tokens. A JWT is a JSON-based token that is used to securely transmit information between parties. It is a compact and self-contained format that can be easily transmitted over various communication channels. The JWT is signed with a secret key, which is used to verify its authenticity and integrity. The JWT contains three parts: the header, the payload, and the signature. The header contains information about the token, such as the type of token and the algorithm used to sign it. The payload contains the user's information, in our case the user's ID, username, email and time of expiration. The signature is a hash of the header and payload, which is used to verify the authenticity of the token. The system uses the JWT library to generate and verify tokens. When a user logs in or register for first time, the system generates a token and stores it in the database. The token is then included in the header of the request when the user makes a request to the system. The system verifies the token thanks to the middleware by checking the signature and the payload. If the token is valid, the system allows the user to access the requested resource. If the token is invalid, the system returns an error message.